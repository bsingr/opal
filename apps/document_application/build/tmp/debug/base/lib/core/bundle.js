
var vn_cBundle=rb_define_class('Bundle',rb_cObject);var vn_all_bundles=rb_hash_new();rb_ivar_set(vn_cBundle,'@all_bundles',vn_all_bundles);function vn_bundle_create_from_parse_text(bundle_text){var url_mapper=function(){var str_len=marker_count();var url=get_next(marker_count());var url_map=get_next(marker_count());rb_funcall(rb_ivar_get(result,'@url_map'),'store',url,url_map);};var resource_mapper=function(){var str_len=marker_count();var resource=get_next(marker_count());var resource_map=get_next(marker_count());rb_funcall(rb_ivar_get(result,'@resources'),'store',resource,resource_map);};var bundle_path=function(){var str_len=marker_count();var str=get_next(str_len);return str;};var code=function(){var str_len=marker_count();var str=get_next(str_len);return str;};var next=function(c){if(c&&c!==ch){console.log('bundle parse error: Expected '+c+', but instead got '+ch);}
ch=text.charAt(at);at+=1;return ch;};var get_next=function(i){var result=text.substr(at,i);at+=i;return result;};var marker_count=function(){var len='';next();while(ch>='0'&&ch<='9'){len+=ch;next();}
return parseInt(len);};var result=rb_funcall(vn_cBundle,'new');var at=0;var ch='';var text=bundle_text;var bundle_format=(function(){var marker=text.indexOf('$',at);var format=text.substr(at,marker-at);at=marker+1;return format;})();var bundle_version=(function(){var marker=text.indexOf('$',at);var version=text.substr(at,marker-at);at=marker+1;return version;})();while(next()){switch(ch){case'p':var path=bundle_path()
rb_ivar_set(result,'@bundle_path',path);break;case'c':var code_fragment=code();rb_ivar_get(result,'@executable_codes').push(code_fragment);break;case'u':url_mapper();break;case'r':resource_mapper();break;default:console.log('wtf? bundle parse unknown marker - '+ch);return result;}};return result;};function vn_bundle_finish_loading(a_bundle){rb_ivar_set(a_bundle,'@info_dictionary',vn_binary_plist_parse(rb_funcall(rb_ivar_get(a_bundle,'@resources'),'[]','info.yml')));var codes=rb_ivar_get(a_bundle,'@executable_codes');while(codes.length){window.vn_current_bundle=a_bundle;eval(codes.pop());}};function vn_bundle_initialize(self,_cmd){rb_ivar_set(self,'@executable_codes',[]);rb_ivar_set(self,'@resources',rb_hash_new());rb_ivar_set(self,'@url_map',rb_hash_new());};rb_define_method(vn_cBundle,'initialize',vn_bundle_initialize);