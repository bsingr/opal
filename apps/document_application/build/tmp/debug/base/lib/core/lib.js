
function vn_lib(path,load_callback){this.path=path;this.load_callback=load_callback;this.bundles=[];this.executable_codes=[];};vn_lib.prototype.load=function(){var lib=this;var request=new XMLHttpRequest();request.open("GET",this.path,true);request.onreadystatechange=function(){if(request.readyState==4){lib.parse(request.responseText);lib.finish_loading();lib.load_callback(lib);}}
request.send(null)};vn_lib.prototype.finish_loading=function(){for(var i=0;i<this.executable_codes.length;i++){eval(this.executable_codes[i]);}
for(var b=0;b<this.bundles.length;b++){vn_bundle_finish_loading(this.bundles[b]);}
rb_funcall(rb_cObject.$iv_tbl.Vienna,'ApplicationMain');};vn_lib.prototype.add_environment_keys=function(hash){};vn_lib.prototype.add_executable_code=function(str){this.executable_codes.push(str);};vn_lib.prototype.add_bundle=function(bundle_text){var the_bundle=vn_bundle_create_from_parse_text(bundle_text);this.bundles.push(the_bundle);rb_funcall(vn_all_bundles,'store',rb_ivar_get(the_bundle,'@bundle_path'),the_bundle);};vn_lib.prototype.parse=function(parse_text){var environment=function(){var str_len=marker_count();var str=get_next(str_len);return vn_yaml_quick_parse_text(str);};var code=function(){var str_len=marker_count();var str=get_next(str_len);return str;};var bundle=function(){var str_len=marker_count();var str=get_next(str_len);return str;};var next=function(c){if(c&&c!==ch){console.log('file parse error: Expected '+c+', but instead got '+ch);}
ch=text.charAt(at);at+=1;return ch;};var get_next=function(i){var result=text.substr(at,i);at+=i;return result;};var marker_count=function(){var len='';next();while(ch>='0'&&ch<='9'){len+=ch;next();}
return parseInt(len);};var lib_format=function(){var marker=text.indexOf('$',at);var format=text.substr(at,marker-at);at=marker+1;return format;};var lib_version=function(){var marker=text.indexOf('$',at);var version=text.substr(at,marker-at);at=marker+1;return version;};var at=0;var ch='';var text=parse_text;var format=lib_format();var version=lib_version();while(next()){switch(ch){case'e':this.add_environment_keys(environment());break;case'c':this.add_executable_code(code());break;case'b':this.add_bundle(bundle());break;default:console.log('wtf? lib parse unknown marker');return;}};};